<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEX BTC/SOL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        header {
            background-color: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }

        header a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        main {
            display: grid;
            grid-template-columns: 2fr 3fr;
            grid-gap: 10px;
            margin: 20px;
        }

        .left-section, .right-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
        }

        #priceChart {
            border: 1px solid black;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
            text-align: center;
        }

        th, td {
            padding: 8px;
        }

        .btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html">Voltar para Página Inicial</a>
    </header>
    <main>
        <section class="left-section">
            <h2>Troca de BTC/SOL</h2>

            <h3>Seu Saldo</h3>
            <p>BTC: <span id="btcBalance">0.00</span></p>
            <p>SOL: <span id="solBalance">0.00</span></p>

            <h3>Comprar/Vender BTC/SOL</h3>
            <form id="tradeForm">
                <label for="orderType">Tipo de Ordem:</label>
                <select id="orderType">
                    <option value="market">Mercado</option>
                    <option value="limit">Limitada</option>
                </select><br><br>
                <label for="tradeAction">Ação:</label>
                <select id="tradeAction">
                    <option value="buy">Comprar</option>
                    <option value="sell">Vender</option>
                </select><br><br>
                <label for="tradeAmount">Quantidade (BTC):</label>
                <input type="number" id="tradeAmount" step="0.0001" required><br><br>
                <button type="button" class="btn" id="tradeButton">Executar</button>
                <div>
                    <button type="button" onclick="setPercentage(10)">10%</button>
                    <button type="button" onclick="setPercentage(30)">30%</button>
                    <button type="button" onclick="setPercentage(50)">50%</button>
                    <button type="button" onclick="setPercentage(80)">80%</button>
                    <button type="button" onclick="setPercentage(100)">100%</button>
                </div>
            </form>
        </section>

        <section class="right-section">
            <h2>Gráfico de Preços BTC/SOL</h2>
            <h3 id="priceDisplay">Preço Atual BTC/SOL: Carregando...</h3>
            <canvas id="priceChart" width="800" height="400"></canvas>
            <h2>Livro de Ofertas</h2>
            <h3>Ordens de Compra</h3>
            <table>
                <thead>
                    <tr>
                        <th>Quantidade (BTC)</th>
                        <th>Preço (SOL)</th>
                    </tr>
                </thead>
                <tbody id="buyOrders"></tbody>
            </table>

            <h3>Ordens de Venda</h3>
            <table>
                <thead>
                    <tr>
                        <th>Quantidade (BTC)</th>
                        <th>Preço (SOL)</th>
                    </tr>
                </thead>
                <tbody id="sellOrders"></tbody>
            </table>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const btcBalanceElement = document.getElementById('btcBalance');
        const solBalanceElement = document.getElementById('solBalance');
        const priceDisplay = document.getElementById('priceDisplay');
        const buyOrdersElement = document.getElementById('buyOrders');
        const sellOrdersElement = document.getElementById('sellOrders');
        const priceChartCanvas = document.getElementById('priceChart').getContext('2d');

        let balances = { BTC: 1.0, SOL: 100.0 }; // Saldo fictício
        let buyOrders = [];
        let sellOrders = [];

        function updateBalances() {
            btcBalanceElement.textContent = balances.BTC.toFixed(4);
            solBalanceElement.textContent = balances.SOL.toFixed(4);
        }

        function addOrder(type, amount, price) {
            const order = { amount, price };
            if (type === 'buy') {
                buyOrders.push(order);
                const row = `<tr><td>${amount}</td><td>${price}</td></tr>`;
                buyOrdersElement.innerHTML += row;
            } else {
                sellOrders.push(order);
                const row = `<tr><td>${amount}</td><td>${price}</td></tr>`;
                sellOrdersElement.innerHTML += row;
            }
        }

        function setPercentage(percent) {
            const tradeAction = document.getElementById('tradeAction').value;
            const balance = tradeAction === 'buy' ? balances.SOL : balances.BTC;
            const input = document.getElementById('tradeAmount');
            input.value = ((balance * percent) / 100).toFixed(4);
        }

        document.getElementById('tradeButton').addEventListener('click', () => {
            const action = document.getElementById('tradeAction').value;
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const price = 10; // Preço fictício para BTC/SOL
            if (action === 'buy' && balances.SOL >= amount * price) {
                balances.SOL -= amount * price;
                balances.BTC += amount;
                addOrder('buy', amount, price);
            } else if (action === 'sell' && balances.BTC >= amount) {
                balances.BTC -= amount;
                balances.SOL += amount * price;
                addOrder('sell', amount, price);
            }
            updateBalances();
        });

        // Configuração inicial do gráfico
        const chart = new Chart(priceChartCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Preço BTC/SOL',
                    data: [],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    fill: false,
                }]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: 'Tempo' } },
                    y: { title: { display: true, text: 'Preço BTC/SOL' } }
                }
            }
        });

        async function fetchPriceData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,solana&vs_currencies=usd');
                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }

                const data = await response.json();
                const btcPrice = data.bitcoin.usd;
                const solPrice = data.solana.usd;

                const currentPrice = (btcPrice / solPrice).toFixed(4);
                priceDisplay.textContent = `Preço Atual BTC/SOL: ${currentPrice}`;

                const now = new Date().toLocaleTimeString();
                chart.data.labels.push(now);
                chart.data.datasets[0].data.push(currentPrice);

                if (chart.data.labels.length > 10) {
                    chart.data.labels.shift();
                    chart.data.datasets[0].data.shift();
                }

                chart.update();
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
                priceDisplay.textContent = 'Erro ao carregar preço';
            }
        }

        setInterval(fetchPriceData, 10000);
        fetchPriceData();
    </script>
</body>
</html>
